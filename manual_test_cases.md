# 租帮宝 V2.0 交付前人工验收测试用例

本测试计划旨在验证 V2 版本引入的“高性价比防破解”方案（Config Token + 签名校验 + 运行时保护）及基础业务功能。

## 环境准备
1. **服务端**：确保 `start_server.bat` 已运行，API 服务正常（默认端口 5005）。
2. **客户端**：使用 `start_client.bat` 启动。
3. **测试工具**：准备 `verify_token_rotation.py` 脚本用于验证 Token 机制。

---

## 模块一：启动与授权（V2 核心）

| ID | 测试场景 | 操作步骤 | 预期结果 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **A01** | **首次启动（无授权）** | 1. 清除客户端 `license.json`。<br>2. 启动客户端。 | 弹出“请输入授权码进行激活”对话框。 | 验证未授权拦截 |
| **A02** | **正常激活** | 1. 在 A01 弹框中输入有效授权码。<br>2. 点击确定。 | 1. 提示“激活成功，欢迎使用”。<br>2. 自动进入主界面。 | 验证激活流程 |
| **A03** | **授权过期启动** | 1. 修改服务端数据库，将该授权码 `expire_date` 改为昨天。<br>2. 启动客户端。 | 启动时直接弹出“授权已过期”警告，并要求输入新码。 | 验证启动时过期检查 |
| **A04** | **服务器离线启动（宽限期内）** | 1. 关闭服务端。<br>2. 确保客户端之前成功启动过（有缓存且在24h内）。<br>3. 启动客户端。 | 1. 启动稍微变慢（网络超时）。<br>2. **成功进入主界面**（触发宽限期逻辑）。 | 验证离线可用性 |
| **A05** | **服务器离线启动（超过宽限期）** | 1. 关闭服务端。<br>2. 修改客户端 `state.json` 中的 `last_ok_ts` 为 25 小时前。<br>3. 启动客户端。 | 弹出“连接失败/网络连接异常”重试框，无法进入主界面。 | 验证宽限期截止 |

---

## 模块二：配置同步与保护（V2 核心）

| ID | 测试场景 | 操作步骤 | 预期结果 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **B01** | **配置自动拉取** | 1. 启动服务端和客户端。<br>2. 观察客户端日志或界面。 | 客户端成功获取服务端配置（包含6个站点信息），且无报错。 | 验证配置下发 |
| **B02** | **敏感信息剥离** | 1. 检查客户端收到的配置（可查看 `config.json` 或日志）。 | 确认配置中**不包含** `username`, `password`, `webhook` 等敏感字段。 | 验证数据安全 |
| **B03** | **Token 自动轮转** | 1. 保持客户端运行。<br>2. 运行脚本 `python verify_token_rotation.py`。 | 脚本输出 `SUCCESS: Token was automatically refreshed!`。 | 验证 Token 机制 |
| **B04** | **配置篡改防护** | 1. 手动修改服务端返回的 `common_config` 签名数据（模拟中间人攻击）。<br>2. 客户端尝试获取配置。 | 客户端提示“配置签名无效”并拒绝加载配置。 | 需要抓包或改代码模拟 |

---

## 模块三：业务功能回归

| ID | 测试场景 | 操作步骤 | 预期结果 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **C01** | **多站点登录** | 1. 在客户端配置界面填写“诚赁”和“奥租”的账号密码。<br>2. 点击“开始监控”。 | 两个站点均能成功登录，状态栏显示“监控中”。 | 验证选择器配置正确 |
| **C02** | **订单监控** | 1. 保持监控状态。<br>2. 等待一个监控周期（默认420秒，可临时改短测试）。 | 日志显示正在轮询订单，且无报错。 | 验证核心业务 |
| **C03** | **桌面通知** | 1. 模拟一个新订单（或手动触发通知测试）。 | 桌面右下角弹出通知弹窗。 | 验证通知功能 |

---

## 模块四：异常处理

| ID | 测试场景 | 操作步骤 | 预期结果 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **D01** | **运行时断网** | 1. 客户端运行中，断开网络。<br>2. 等待心跳周期（5分钟）。 | 客户端不应立即退出，日志提示“进入宽限期”。 | 验证运行时容错 |
| **D02** | **配置同步失败** | 1. 启动时断网。<br>2. 本地有旧配置。 | 提示“配置同步失败”但允许选择“取消”进入主界面（使用缓存）。 | 验证降级策略 |

## 交付建议
- 建议优先执行 **A02, A04, B01, C01** 四个核心用例，确保基本交付质量。
- **B03** 脚本测试建议由开发人员执行一次截图留存。
